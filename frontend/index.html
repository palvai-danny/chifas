<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CHIFAS – Document Intake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; font-family: Arial, sans-serif; }
    body { margin: 0; background: #fff; color: #000; }
    h1, h2 { margin-bottom: 10px; }
    .container { max-width: 900px; margin: auto; padding: 30px; }
    .hidden { display: none; }

    input, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0 14px;
      border: 1px solid #000;
      background: #fff;
      color: #000;
    }

    button {
      background: #000;
      color: #fff;
      cursor: pointer;
    }

    .link { text-align: center; cursor: pointer; text-decoration: underline; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #000;
      padding: 10px;
      text-align: left;
    }

    th { background: #f5f5f5; }

    .plus-btn {
      width: 35px;
      height: 35px;
      font-size: 20px;
      padding: 0;
    }
  </style>
</head>

<body>

<div class="container">

  <!-- LOGIN -->
  <div id="loginPage">
    <h1>CHIFAS Login</h1>
    <input id="email" type="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password"  />
    <button onclick="login()">Login</button>

    <p class="link">
      New user?
      <a href="signup.html">Sign up</a>
    </p>
  </div>

  <!-- DOCUMENT UPLOAD -->
  <div id="uploadPage" class="hidden">
    <h2>Document Checklist</h2>

    <table>
      <tr><th>Document</th><th>Upload</th></tr>
      <tr><td>Aadhaar</td><td><input type="file" id="aadhaarFile" /></td></tr>
      <tr><td>10th Memo</td><td><input type="file" id="10thmemo" /></td></tr>
      <!-- <tr><td>12th Memo</td><td><input type="file" /></td></tr>
      <tr><td>Photo</td><td><input type="file" /></td></tr>
      <tr><td>Signature</td><td><input type="file" /></td></tr> -->
      <!-- <tbody id="extraDocs"></tbody> -->
    </table>

    <!-- <button class="plus-btn" onclick="addDoc()">+</button> -->
    <button onclick="goToDetails()">Continue</button>
  </div>

  <!-- USER DETAILS -->
<div id="detailsPage" class="hidden">
  <h2>User Details</h2>
  <div class="input-row">
  <label for="studentName">Candidate Name:</label>
  <input type="text" id="studentName" placeholder="Candidate Name">
   <!-- <label for="dob">DOB:</label> -->
  <!-- <input id="dob" placeholder="DOB" /> -->

    <!-- <input id="studentName" placeholder="Candidate Name"/> -->
     <label for="dob">DOB:</label>
    <input id="dob" placeholder="DOB" />
    <label for="aadhaar">Aadhaar Number:</label>
    <input id="aadhaar" placeholder="Aadhaar Number" />
    <label for="gender">Gender:</label>
    <input id="gender" placeholder="Gender" />
    <label for="fatherName">Father's Name:</label>
    <input id="fatherName" placeholder="Father's Name" />
    <label for="motherName">Mother's Name:</label>
    <input id="motherName" placeholder="Mother's Name" />

    <h3>Manual Details</h3>
<label for="candidateEmail">Candidate Email:</label>
<input id="candidateEmail" placeholder="Candidate Email" />
<label for="parentEmail">Parent's Email:</label>
<input id="parentEmail" placeholder="Parent's Email" />
<label for="motherName">Candidate Mobile Number:</label>
<input id="candidateMobile" placeholder="Candidate Mobile Number" />
<label for="fatherMobile">Father Mobile Number:</label>
<input id="fatherMobile" placeholder="Father Mobile Number" />
<label for="motherMobile">Mother Mobile Number:</label>
<input id="motherMobile" placeholder="Mother Mobile Number" />

<div class="dropdown-container">
    <select id="category" required>
        <option value="" disabled selected>Select Your Category</option>
        <option value="general">General</option>
        <option value="sc">SC</option>
        <option value="st">ST</option>
        <option value="obc">OBC</option>
        <option value="ews">EWS</option>
        <option value="others">Others</option>
    </select>
</div>
<br>
<div class="dropdown-container">
    <select id="country" required>
        <option value="" disabled selected>Select Your Country</option>
        <option value="indian">Indian</option>
        <option value="nri">NRI</option>
        <option value="others">Others</option>
    </select>
</div>

<h3>Permanent Address</h3>
<label for="currentAddress">Current Address:</label>
<input id="currentAddress" placeholder="Current Address" />
<label for="district">Distr:</label>
<input id="district" placeholder="Dist" />
<label for="state">State:</label>
<input id="state" placeholder="State" />
<label for="pincode">Pin Code:</label>
<input id="pincode" placeholder="Pin Code" />

<button onclick="saveDetails()">Save Details</button>

  </div>
  
</div>

<script>
  let extraCount = 0;

  async function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  if (!email || !password) {
  alert("All fields required");
  return;
}
  const res = await fetch(
    "http://localhost:8787/login",
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    }
  );

  const data = await res.json();

  if (!res.ok) {
  alert(data.message);
  return;
}

//  Store userId globally
window.currentUserId = data.userId;
 //  STORE FOR EXTENSION (ADD THIS LINE HERE)
localStorage.setItem("chifasUserId", data.userId);
  // if (!res.ok) {
  //   alert(data.message);
  //   return;
  // }

  // Auth success → move forward
  document.getElementById("loginPage").classList.add("hidden");
  document.getElementById("uploadPage").classList.remove("hidden");
}


  // function addDoc() {
  //   if (extraCount >= 5) {
  //     alert('Maximum 5 extra documents allowed');
  //     return;
  //   }
  //   extraCount++;
  //   const row = document.createElement('tr');
  //   row.innerHTML = `
  //     <td>Other Certificate ${extraCount}</td>
  //     <td><input type="file" /></td>
  //   `;
  //   document.getElementById('extraDocs').appendChild(row);
  // }
async function saveDetails() {
  const data = {
    userId: window.currentUserId,

    student_name: document.getElementById("studentName").value,
    dob: document.getElementById("dob").value,
    aadhaar: document.getElementById("aadhaar").value,
    gender: document.getElementById("gender").value,
    father_name: document.getElementById("fatherName").value,
    mother_name: document.getElementById("motherName").value,

    candidate_email: document.getElementById("candidateEmail").value,
    parent_email: document.getElementById("parentEmail").value,
    candidate_mobile: document.getElementById("candidateMobile").value,
    father_mobile: document.getElementById("fatherMobile").value,
    mother_mobile: document.getElementById("motherMobile").value,

    category: document.getElementById("category").value,
    country: document.getElementById("country").value,

    current_address: document.getElementById("currentAddress").value,
    district: document.getElementById("district").value,
    state: document.getElementById("state").value,
    pincode: document.getElementById("pincode").value,
  };

  const res = await fetch("http://localhost:8787/save-details", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  const result = await res.json();
  alert(result.message);
}

  async function goToDetails() {

  const fileInput1 = document.getElementById("aadhaarFile");
  const fileInput2 = document.getElementById("10thmemo");
  if (!fileInput1) {
    alert("aadhaarFile not found");
    return;
  }
    if (!fileInput2) {
    alert("10th Memo not found");
    return;
  }
  const file1 = fileInput1.files[0];
  if (!file1) {
    alert("Please upload Aadhaar first");
    return;
  }
  const file2 = fileInput2.files[0];
  if (!file2) {
    alert("Please upload 10th Memo first");
    return;
  }

  const formData = new FormData();
  formData.append("aadhaar", file1);
  formData.append("memo", file2);
  formData.append("userId", window.currentUserId);



  try {
    const res = await fetch("http://localhost:8787/ocr", {
      method: "POST",
      body: formData
    });

    const data = await res.json();

    if (!res.ok) {
      console.log(res.error);
      alert("OCR Failed");
      return;
    }

    const nameField = document.getElementById("studentName");
    const dobField = document.getElementById("dob");
    const aadhaarField = document.getElementById("aadhaar");
    const genderField = document.getElementById("gender");
    const fatherNameField = document.getElementById("fatherName");
    const motherNameField = document.getElementById("motherName");


    if (nameField) nameField.value = data.student_name || "";
    if (dobField) dobField.value = data.dob || "";
    if (aadhaarField) aadhaarField.value = data.aadhaar || "";
    if (genderField) genderField.value = data.gender || "";
    if (fatherNameField) fatherNameField.value = data.father_name || "";
    if (motherNameField) motherNameField.value = data.mother_name || "";

    document.getElementById('uploadPage').classList.add('hidden');
    document.getElementById('detailsPage').classList.remove('hidden');

  } catch (err) {
    console.error(err);
    alert("Server error");
  }
}


</script>

</body>
</html>